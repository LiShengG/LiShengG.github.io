(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{387:function(t,s,n){"use strict";n.r(s);var a=n(4),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("1、除了 mutex 以外还有那些方式安全读写共享变量？\n2、Go 如何实现原子操作？\n3、Mutex 是悲观锁还是乐观锁？悲观锁、乐观锁是什么？\n4、Mutex 有几种模式？\n5、goroutine 的自旋占用资源如何解决")])]),t._v(" "),s("p",[t._v("通常涉及 "),s("code",[t._v("sync.Mutex")]),t._v("、"),s("code",[t._v("sync.RWMutex")]),t._v(" 等常见的锁类型，以及与锁相关的最佳实践、问题排查等")]),t._v(" "),s("h3",{attrs:{id:"_1-mutex-的基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-mutex-的基本概念"}},[t._v("#")]),t._v(" 1. "),s("strong",[t._v("Mutex 的基本概念")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 什么是 "),s("code",[t._v("sync.Mutex")]),t._v("？它是如何工作的？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[s("code",[t._v("sync.Mutex")]),t._v(" 是 Go 标准库中的一种互斥锁，用于保护共享资源的访问。")]),t._v(" "),s("li",[t._v("通过 "),s("code",[t._v("Lock")]),t._v(" 方法加锁，"),s("code",[t._v("Unlock")]),t._v(" 方法解锁。在加锁后，其他 Goroutine 需要等到解锁才能继续访问共享资源。")])])])]),t._v(" "),s("h3",{attrs:{id:"_2-mutex-的使用示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mutex-的使用示例"}},[t._v("#")]),t._v(" 2. "),s("strong",[t._v("Mutex 的使用示例")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 请写出使用 "),s("code",[t._v("sync.Mutex")]),t._v(" 来保护一个共享变量的代码示例。")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":"),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" mu sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Mutex\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("increment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    count"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\n    mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" wg sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WaitGroup\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        wg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" wg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Done")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("increment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    wg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Wait")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Final count:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br")])])])]),t._v(" "),s("h3",{attrs:{id:"_3-死锁的概念与避免"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-死锁的概念与避免"}},[t._v("#")]),t._v(" 3. "),s("strong",[t._v("死锁的概念与避免")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 什么是死锁？在使用锁时如何避免死锁？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("死锁是指两个或多个 Goroutine 因相互等待对方持有的锁，而陷入无限期的等待状态，导致程序无法继续执行。")]),t._v(" "),s("li",[t._v("避免死锁的方法包括：避免嵌套锁、尝试使用定时锁、在相同顺序下加锁、最小化锁持有的时间。")])])])]),t._v(" "),s("h3",{attrs:{id:"_4-sync-rwmutex-的使用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-sync-rwmutex-的使用场景"}},[t._v("#")]),t._v(" 4. "),s("strong",[s("code",[t._v("sync.RWMutex")]),t._v(" 的使用场景")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 什么是 "),s("code",[t._v("sync.RWMutex")]),t._v("？它和 "),s("code",[t._v("sync.Mutex")]),t._v(" 有什么区别？适用于什么场景？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[s("code",[t._v("sync.RWMutex")]),t._v(" 是一种读写锁，允许多个 Goroutine 同时读取，但在写入时会独占锁。")]),t._v(" "),s("li",[t._v("与 "),s("code",[t._v("sync.Mutex")]),t._v(" 不同，"),s("code",[t._v("RWMutex")]),t._v(" 提供了 "),s("code",[t._v("RLock")]),t._v(" 和 "),s("code",[t._v("RUnlock")]),t._v(" 方法，用于读操作，加速了并发读多于写的场景。")]),t._v(" "),s("li",[t._v("适用于读多写少的场景，如缓存系统。")])])])]),t._v(" "),s("h3",{attrs:{id:"_5-锁的竞态条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-锁的竞态条件"}},[t._v("#")]),t._v(" 5. "),s("strong",[t._v("锁的竞态条件")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 什么是竞态条件？如何使用锁来避免竞态条件？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("竞态条件是指多个 Goroutine 同时访问和修改共享数据时，由于访问顺序不确定而引发的数据不一致问题。")]),t._v(" "),s("li",[t._v("使用 "),s("code",[t._v("sync.Mutex")]),t._v(" 或 "),s("code",[t._v("sync.RWMutex")]),t._v(" 来保护共享资源，确保同一时刻只有一个 Goroutine 能修改数据，从而避免竞态条件。")])])])]),t._v(" "),s("h3",{attrs:{id:"_6-defer-与锁的配合使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-defer-与锁的配合使用"}},[t._v("#")]),t._v(" 6. "),s("strong",[s("code",[t._v("defer")]),t._v(" 与锁的配合使用")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 为什么推荐使用 "),s("code",[t._v("defer")]),t._v(" 来解锁？请给出一个例子。")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("使用 "),s("code",[t._v("defer")]),t._v(" 可以确保锁在函数退出时一定会被释放，避免因函数中途返回或发生错误而导致的锁泄漏。")]),t._v(" "),s("li",[t._v("示例："),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// critical section")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])])])])]),t._v(" "),s("h3",{attrs:{id:"_7-锁的嵌套与递归"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-锁的嵌套与递归"}},[t._v("#")]),t._v(" 7. "),s("strong",[t._v("锁的嵌套与递归")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": Go 的 "),s("code",[t._v("sync.Mutex")]),t._v(" 是否支持递归锁定？为什么？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("Go 的 "),s("code",[t._v("sync.Mutex")]),t._v(" 不支持递归锁定，即一个 Goroutine 不能对同一把锁进行多次加锁，否则会导致死锁。")]),t._v(" "),s("li",[t._v("这与一些其他编程语言（如 C++ 的 "),s("code",[t._v("std::recursive_mutex")]),t._v("）不同，Go 的锁设计更加简单和直接。")])])])]),t._v(" "),s("h3",{attrs:{id:"_8-避免锁的性能瓶颈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-避免锁的性能瓶颈"}},[t._v("#")]),t._v(" 8. "),s("strong",[t._v("避免锁的性能瓶颈")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 在高并发程序中，如何避免因锁的使用而导致的性能瓶颈？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("最小化锁的粒度，只锁住关键的代码部分。")]),t._v(" "),s("li",[t._v("使用 "),s("code",[t._v("sync.RWMutex")]),t._v(" 来区分读写锁，减少不必要的写锁争用。")]),t._v(" "),s("li",[t._v("考虑使用无锁数据结构（如 "),s("code",[t._v("sync.Map")]),t._v("）或锁分片技术来减小锁的争用。")]),t._v(" "),s("li",[t._v("尽量减少锁的持有时间，避免在持有锁的情况下执行耗时操作。")])])])]),t._v(" "),s("h3",{attrs:{id:"_9-sync-cond-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-sync-cond-的使用"}},[t._v("#")]),t._v(" 9. "),s("strong",[s("code",[t._v("sync.Cond")]),t._v(" 的使用")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 什么是 "),s("code",[t._v("sync.Cond")]),t._v("？它的作用是什么？请给出使用 "),s("code",[t._v("sync.Cond")]),t._v(" 实现生产者-消费者模型的示例。")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[s("code",[t._v("sync.Cond")]),t._v(" 是一种条件变量，可以让一个或多个 Goroutine 等待或广播某个条件的发生。")]),t._v(" "),s("li",[t._v("适用于需要在某个条件满足时通知其他 Goroutine 的场景。")]),t._v(" "),s("li",[t._v("示例："),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" mu sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Mutex\ncond "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" sync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewCond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nqueue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    cond"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Signal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("consume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        cond"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Wait")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    mu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Consumed:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("consume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("produce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br")])])])])])]),t._v(" "),s("h3",{attrs:{id:"_10-锁与原子操作的比较"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-锁与原子操作的比较"}},[t._v("#")]),t._v(" 10. "),s("strong",[t._v("锁与原子操作的比较")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": Go 语言中的锁与原子操作（如 "),s("code",[t._v("sync/atomic")]),t._v(" 包中的操作）有何不同？在什么情况下应使用原子操作而不是锁？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("锁可以保护复杂的临界区，而原子操作适用于对单个变量的简单读写操作。")]),t._v(" "),s("li",[t._v("原子操作通常比锁开销更小，因为它们不涉及上下文切换和调度器干预。")]),t._v(" "),s("li",[t._v("在高并发环境中，如果只需对整数、布尔值等基本数据类型进行简单的增减或状态检查，原子操作是更好的选择。")])])])]),t._v(" "),s("h3",{attrs:{id:"_11-锁的使用陷阱"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11-锁的使用陷阱"}},[t._v("#")]),t._v(" 11. "),s("strong",[t._v("锁的使用陷阱")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 在使用锁时，有哪些常见的陷阱或错误？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("忘记解锁：在使用 "),s("code",[t._v("Lock")]),t._v(" 后没有调用 "),s("code",[t._v("Unlock")]),t._v("，导致死锁。")]),t._v(" "),s("li",[t._v("重复解锁：多次调用 "),s("code",[t._v("Unlock")]),t._v("，会引发 panic。")]),t._v(" "),s("li",[t._v("使用锁保护的代码过多，导致性能问题。")]),t._v(" "),s("li",[t._v("在锁保护下调用可能会阻塞的操作（如网络或文件 I/O），导致长时间持有锁，从而降低并发性。")])])])]),t._v(" "),s("h3",{attrs:{id:"_12-死锁检测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_12-死锁检测"}},[t._v("#")]),t._v(" 12. "),s("strong",[t._v("死锁检测")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("问题")]),t._v(": 如何检测和调试 Go 程序中的死锁问题？")]),t._v(" "),s("li",[s("strong",[t._v("回答要点")]),t._v(":\n"),s("ul",[s("li",[t._v("使用 Go 的内置工具 "),s("code",[t._v("go build -race")]),t._v(" 来检测数据竞争和死锁。")]),t._v(" "),s("li",[t._v("检查程序是否在特定锁上永久阻塞，或使用较长的超时时间来定位死锁发生的 Goroutine。")]),t._v(" "),s("li",[t._v("通过分析 Goroutine 堆栈追踪，找到所有正在等待锁的 Goroutine 以及它们的状态。")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);